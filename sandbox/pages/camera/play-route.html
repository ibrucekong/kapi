<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Play Route - KAPI</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimal-ui">
  <meta name="description" content="KAPI"/>
  <link rel='stylesheet' href='./css/index.css'>
  <style type='text/css'>
    #kapi-container {
      width: 100%;
      height: 60%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .operation-range {
      width: 100%;
      height: 40%;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
  </style>
</head>
<body onload='init()'>
<div class='container'>
  <div id='kapi-container'></div>
  <div class='operation-range'>
    <div class='row'>
      <div class='btn' onclick='play()'>开始漫游</div>
      <div class='btn' onclick='stop()'>停止漫游</div>
    </div>
  </div>
</div>
<pre id='console-log'><code id='logs'></code></pre>
<script src="./config.js"></script>
<script src="js/jquery-1.8.3.min.js"></script>
<link href="js/highlight/intellij-light.min.css" rel="stylesheet">
<script src="js/highlight/highlight.min.js"></script>
<script src="./js/kapi.js"></script>
<script>
  let camera

  async function init() {
    let kapi = await KAPI.build(config.token)

    // 设置参数
    let options = {
      server,                                                    // 服务地址
      netStats: false,                                           // 是否显示网络信息
      fullscreen: true                                          // 是否要全屏
    }
    // 初始化场景
    let scene = new kapi.Scene('kapi-container', options)
    // 等待场景响应好
    let readyStat = await scene.ready()
    printLog(readyStat)
    if (readyStat.code !== 200) return

    // 实例化
    camera = new kapi.Camera()

    let event = new kapi.Event()
    // 监听漫游开始的事件监听
    event.addEventListener(KAPI_CONST.EVENT.ROUTE.START, response => {
      console.log(response)
    })
    // 监听漫游时的事件监听
    event.addEventListener(KAPI_CONST.EVENT.ROUTE.MOVING, response => {
      console.log(response)
    })
    // 监听漫游结束的事件监听
    event.addEventListener(KAPI_CONST.EVENT.ROUTE.END, response => {
      console.log(response)
    })
  }

  async function play() {

    let route = [{
      x: 511127.625, y: 4056989, z: 84.9941177368164,
      rotation: {roll: -0.000015942847312544473, pitch: -7.813995361328125, yaw: -137.52830505371094}
    }, {
      x: 511109.8125, y: 4057004.75, z: 84.99378967285156,
      rotation: {roll: 0.000011849412658193614, pitch: -7.813995361328125, yaw: -140.55975341796875}
    }, {
      x: 511086.3125, y: 4057023.5, z: 84.84740447998047,
      rotation: {roll: 0.0000013899874602429918, pitch: -3.5085723400115967, yaw: -139.4395751953125}
    }, {
      x: 511063.96875, y: 4057043.5, z: 84.72782135009766,
      rotation: {roll: -0.000012394911209412385, pitch: -2.8372740745544434, yaw: -140.47731018066406}
    }, {
      x: 511038.71875, y: 4057059, z: 85.03816223144531,
      rotation: {roll: -4.318528397107002e-7, pitch: -8.697460174560547, yaw: -165.1785888671875}
    }, {
      x: 511009.71875, y: 4057067, z: 85.2235336303711,
      rotation: {roll: 0.000008303769391204696, pitch: -12.374649047851562, yaw: -165.89334106445312}
    }, {
      x: 510980.5625, y: 4057074, z: 85.26409149169922,
      rotation: {roll: -6.575590987267788e-7, pitch: -13.144739151000977, yaw: -170.62193298339844}
    }, {
      x: 510950.8125, y: 4057077, z: 85.19207000732422,
      rotation: {roll: 0.000004766003257827833, pitch: -11.575127601623535, yaw: -176.0614471435547}
    }, {
      x: 510920.84375, y: 4057076, z: 85.163818359375,
      rotation: {roll: 0.0000010331315252187778, pitch: -11.085075378417969, yaw: -174.81509399414062}
    }, {
      x: 510891.15625, y: 4057080.25, z: 85.2052993774414,
      rotation: {roll: 7.636904229002539e-7, pitch: -11.981954574584961, yaw: -165.37588500976562}
    }, {
      x: 510862.3125, y: 4057088.5, z: 85.24292755126953,
      rotation: {roll: 0.0000024069904611678794, pitch: -12.724313735961914, yaw: -156.93458557128906}
    }, {
      x: 510835.96875, y: 4057102.5, z: 85.2538833618164,
      rotation: {roll: 8.757550631344202e-7, pitch: -12.864339828491211, yaw: -137.09033203125}
    }, {
      x: 510814.8125, y: 4057123.75, z: 85.24312591552734,
      rotation: {roll: 0.000001312542735831812, pitch: -12.654338836669922, yaw: -126.1778335571289}
    }, {
      x: 510797.65625, y: 4057148.25, z: 85.23637390136719,
      rotation: {roll: 0, pitch: -12.444310188293457, yaw: -120.03755950927734}
    }, {
      x: 510783.0625, y: 4057174.5, z: 85.17872619628906,
      rotation: {roll: 0.0000013055763474767446, pitch: -11.211597442626953, yaw: -116.91850280761719}
    }, {
      x: 510770.625, y: 4057201.75, z: 85.15482330322266,
      rotation: {roll: 4.3477609779074555e-7, pitch: -10.931567192077637, yaw: -109.60294342041016}
    }, {
      x: 510746.53125, y: 4057219.5, z: 85.19757843017578,
      rotation: {roll: 0.0000013083888461551396, pitch: -11.816855430603027, yaw: -94.11947631835938}
    }, {
      x: 510728.3125, y: 4057242.25, z: 85.26732635498047,
      rotation: {roll: 0.0000017548221649121842, pitch: -13.329564094543457, yaw: -72.6153335571289}
    }, {
      x: 510730.65625, y: 4057271.25, z: 85.31396484375,
      rotation: {roll: 0.0000026423035706102382, pitch: -14.221900939941406, yaw: -64.20641326904297}
    }, {
      x: 510731.84375, y: 4057299.5, z: 85.32377624511719,
      rotation: {roll: -0.000008807679478195496, pitch: -14.221914291381836, yaw: -64.71500396728516}
    }, {
      x: 510743.1875, y: 4057327, z: 85.2651138305664,
      rotation: {roll: -0.000012702900676231366, pitch: -12.951964378356934, yaw: -84.56400299072266}
    }, {
      x: 510746.21875, y: 4057357, z: 85.25474548339844,
      rotation: {roll: 0.0000013137250789441168, pitch: -12.88196849822998, yaw: -84.71894073486328}
    }, {
      x: 510748.5625, y: 4057386.75, z: 85.24759674072266,
      rotation: {roll: -0.000007440304671035847, pitch: -12.741929054260254, yaw: -89.55027770996094}
    }, {
      x: 510747.78125, y: 4057416.75, z: 85.23688507080078,
      rotation: {roll: -0.000008746109415369574, pitch: -12.53192138671875, yaw: -94.4734115600586}
    }, {
      x: 510745.84375, y: 4057446.75, z: 85.22669219970703,
      rotation: {roll: 4.36952376503541e-7, pitch: -12.321892738342285, yaw: -86.99874877929688}
    }, {
      x: 510748.5, y: 4057476.5, z: 85.21903228759766,
      rotation: {roll: 0.000015285220797522925, pitch: -12.181880950927734, yaw: -82.5536117553711}
    }, {
      x: 510739.125, y: 4057504.25, z: 85.37450408935547,
      rotation: {roll: 0.00000398418933400535, pitch: -15.35429859161377, yaw: -60.404029846191406}
    }, {
      x: 510731.65625, y: 4057534, z: 85.42894744873047,
      rotation: {roll: 8.905331014830153e-7, pitch: -16.519712448120117, yaw: -37.05830764770508}
    }, {
      x: 510736.90625, y: 4057564.25, z: 85.50792694091797,
      rotation: {roll: 0.0000029226957849459723, pitch: -18.307336807250977, yaw: -19.230709075927734}
    }, {
      x: 510753.90625, y: 4057589.25, z: 85.56240844726562,
      rotation: {roll: 7.05426600688952e-7, pitch: -18.99584197998047, yaw: -2.33624267578125}
    }, {
      x: 510777.46875, y: 4057609, z: 85.6243667602539,
      rotation: {roll: 0.000002275354518133099, pitch: -20.270641326904297, yaw: 26.110939025878906}
    }, {
      x: 510806.5, y: 4057618.5, z: 85.64679718017578,
      rotation: {roll: -4.564088555980561e-7, pitch: -20.72062110900879, yaw: 42.84810256958008}
    }, {
      x: 510836.40625, y: 4057618.75, z: 85.63428497314453,
      rotation: {roll: 0.0000027321411835146137, pitch: -20.367828369140625, yaw: 38.23648452758789}
    }, {
      x: 510867.65625, y: 4057619, z: 85.66419982910156,
      rotation: {roll: -9.149500783678377e-7, pitch: -21.070804595947266, yaw: 68.55152130126953}
    }, {
      x: 510894.96875, y: 4057607.5, z: 85.66899108886719,
      rotation: {roll: 0, pitch: -21.210817337036133, yaw: 73.63552856445312}
    }, {
      x: 510920.9375, y: 4057593, z: 85.63653564453125,
      rotation: {roll: 0.000012739702469843905, pitch: -20.242828369140625, yaw: 63.40635681152344}
    }, {
      x: 510948.6875, y: 4057583, z: 85.61359405517578,
      rotation: {roll: 0.0000027262699404673185, pitch: -20.032835006713867, yaw: 60.930091857910156}
    }, {
      x: 510961.625, y: 4057556.25, z: 85.6142807006836,
      rotation: {roll: -0.00001454010543966433, pitch: -20.032835006713867, yaw: 68.67875671386719}
    }, {
      x: 510973.09375, y: 4057528.5, z: 85.58795166015625,
      rotation: {roll: -0.000017210088117280975, pitch: -19.512428283691406, yaw: 66.25395965576172}
    }, {
      x: 510996.03125, y: 4057510.75, z: 85.60346984863281,
      rotation: {roll: 0, pitch: -19.862476348876953, yaw: 77.0969009399414}
    }, {
      x: 511021.4375, y: 4057494.5, z: 85.61355590820312,
      rotation: {roll: 0.0000018179728158429498, pitch: -20.07251739501953, yaw: 81.58354949951172}
    }, {
      x: 511045.75, y: 4057476.5, z: 85.6224594116211,
      rotation: {roll: -9.10211497284763e-7, pitch: -20.28252601623535, yaw: 90.47897338867188}
    }, {
      x: 511065.75, y: 4057454, z: 85.63274383544922,
      rotation: {roll: 0.000014576593457604758, pitch: -20.422544479370117, yaw: 96.63374328613281}
    }, {
      x: 511084, y: 4057429.75, z: 85.6216812133789,
      rotation: {roll: 0.0000018187860177931725, pitch: -20.142513275146484, yaw: 107.43424987792969}
    }, {
      x: 511096.875, y: 4057402.25, z: 85.3641128540039,
      rotation: {roll: 0, pitch: -12.15951156616211, yaw: 117.72782897949219}
    }, {
      x: 511105, y: 4057373.25, z: 84.76004028320312,
      rotation: {roll: 9.626386372474371e-7, pitch: -3.82413387298584, yaw: 121.97905731201172}
    }, {
      x: 511111.4375, y: 4057344, z: 85.26332092285156,
      rotation: {roll: 4.395933501655236e-7, pitch: -13.809487342834473, yaw: 124.02780151367188}
    }, {
      x: 511096.15625, y: 4057319.25, z: 85.38578796386719,
      rotation: {roll: 0.0000013276240906634484, pitch: -15.285162925720215, yaw: 123.55382537841797}
    }, {
      x: 511080.0625, y: 4057294, z: 85.33792877197266,
      rotation: {roll: 0.000007490104508178774, pitch: -14.329490661621094, yaw: 111.06544494628906}
    }, {
      x: 511069.3125, y: 4057266, z: 85.31477355957031,
      rotation: {roll: 0.000010121155355591327, pitch: -14.049466133117676, yaw: 105.38381958007812}
    }, {
      x: 511062.15625, y: 4057236.75, z: 85.30921173095703,
      rotation: {roll: 0.0000013193478025641525, pitch: -13.90944766998291, yaw: 102.22246551513672}
    }, {
      x: 511054.09375, y: 4057208, z: 85.3141860961914,
      rotation: {roll: 0, pitch: -14.04947280883789, yaw: 111.47598266601562}
    }, {
      x: 511042.75, y: 4057180.25, z: 85.26261901855469,
      rotation: {roll: 0.0000013138961776348879, pitch: -12.914555549621582, yaw: 124.53954315185547}
    }, {
      x: 511025.8125, y: 4057155.5, z: 85.20573425292969,
      rotation: {roll: 0.0000021814717001689132, pitch: -11.919793128967285, yaw: 128.8241729736328}
    }, {
      x: 511009.875, y: 4057130.25, z: 85.2134780883789,
      rotation: {roll: 0.000014842515156487934, pitch: -12.074394226074219, yaw: 111.03361511230469}
    }, {
      x: 510998.90625, y: 4057102.25, z: 85.1377182006836,
      rotation: {roll: 8.685926218277018e-7, pitch: -10.598848342895508, yaw: 112.17347717285156}
    }, {
      x: 510987.3125, y: 4057074.75, z: 85.1377182006836,
      rotation: {roll: -0.0000073830374276440125, pitch: -10.598855018615723, yaw: 114.6888656616211}
    }, {
      x: 510976.34375, y: 4057046.75, z: 85.09729766845703,
      rotation: {roll: 0.000008664543202030472, pitch: -9.814482688903809, yaw: 107.58379364013672}
    }, {
      x: 510967.71875, y: 4057018, z: 85.02019500732422,
      rotation: {roll: -0.0000073328747021150775, pitch: -8.245301246643066, yaw: 95.93666076660156}
    }, {
      x: 510964.96875, y: 4056988.25, z: 84.85092163085938,
      rotation: {roll: 2.1428100183129573e-7, pitch: -5.067624568939209, yaw: 93.38825988769531}
    }, {
      x: 510964.4375, y: 4056958.25, z: 84.73200225830078,
      rotation: {roll: 0.0000013884707641409477, pitch: -2.2690024375915527, yaw: 84.65827941894531}
    }, {
      x: 510965.75, y: 4056928.25, z: 84.6452407836914,
      rotation: {roll: 0.0000010674215218386962, pitch: -1.1218857765197754, yaw: 93.97716522216797}
    }, {
      x: 510962.6875, y: 4056898.5, z: 84.66511535644531,
      rotation: {roll: 0.000007526503395638429, pitch: -1.5128867626190186, yaw: 99.65492248535156}
    }, {
      x: 510957.21875, y: 4056869, z: 84.66980743408203,
      rotation: {roll: 8.541348961443873e-7, pitch: -1.666490912437439, yaw: 131.0443572998047}
    }, {
      x: 510933.6875, y: 4056852, z: 84.71333312988281,
      rotation: {roll: -0.000029161332349758595, pitch: -2.4340744018554688, yaw: 157.7584228515625}
    }, {
      x: 510909.09375, y: 4056837, z: 84.70968627929688,
      rotation: {roll: 0.0000010147197144760867, pitch: -2.364071846008301, yaw: 157.75865173339844}
    }, {
      x: 510896.03125, y: 4056809.75, z: 84.71106719970703,
      rotation: {roll: 0.0000010147717830477632, pitch: -2.4340744018554688, yaw: 166.74905395507812}
    }, {
      x: 510879.3125, y: 4056784.5, z: 84.74524688720703,
      rotation: {roll: 9.753717904459336e-7, pitch: -3.216144561767578, yaw: 173.85499572753906}
    }, {
      x: 510859.84375, y: 4056761.75, z: 85.0248794555664,
      rotation: {roll: 0.000005718420197808882, pitch: -8.456375122070312, yaw: 171.366943359375}
    }, {
      x: 510840.46875, y: 4056738.5, z: 85.09558868408203,
      rotation: {roll: 9.746685236677877e-7, pitch: -9.782988548278809, yaw: 180}
    }, {
      x: 510818.03125, y: 4056717.75, z: 85.3733901977539,
      rotation: {roll: 8.865328027241048e-7, pitch: -15.624391555786133, yaw: 196}
    }, {
      x: 510791.71875, y: 4056703.25, z: 85.40097045898438,
      rotation: {roll: -0.000009758558917383198, pitch: -15.76441764831543, yaw: 195}
    }, {
      x: 510764.78125, y: 4056689.75, z: 85.32743072509766,
      rotation: {roll: 0.0000011007746252289508, pitch: -14.183829307556152, yaw: 203}
    }, {
      x: 510737.03125, y: 4056678.25, z: 85.2900390625,
      rotation: {roll: 0.000011856852324854117, pitch: -13.568197250366211, yaw: 203}
    }, {
      x: 510708.96875, y: 4056666.75, z: 85.28289794921875,
      rotation: {roll: 0.0000013166554708732292, pitch: -13.42818546295166, yaw: 213}
    }, {
      x: 510679.40625, y: 4056660.5, z: 85.2535629272461,
      rotation: {roll: 8.752824669500114e-7, pitch: -12.72815227508545, yaw: 220}
    }, {
      x: 510648.5625, y: 4056663.75, z: 85.3064193725586,
      rotation: {roll: 0.00000263863398686226, pitch: -13.904030799865723, yaw: -92.42082977294922 + 360}
    }, {
      x: 510627.75, y: 4056685.25, z: 85.28543853759766,
      rotation: {roll: 0.0000017559505067765713, pitch: -13.484090805053711, yaw: -78.17147827148438 + 360}
    }, {
      x: 510634.6875, y: 4056713.75, z: 85.28901672363281,
      rotation: {roll: -0.0000017564666450198274, pitch: -13.554120063781738, yaw: -74.74022674560547 + 360}
    }, {
      x: 510660.0625, y: 4056728.75, z: 85.27262878417969,
      rotation: {roll: 0, pitch: -13.232083320617676, yaw: -68.94355773925781 + 360}
    }, {
      x: 510687.5, y: 4056741, z: 85.2418441772461,
      rotation: {roll: 0.000008742328645894304, pitch: -12.419946670532227, yaw: -69.50357055664062 + 360}
    }, {
      x: 510714.65625, y: 4056754, z: 85.1598892211914,
      rotation: {roll: -0.000007391994586214423, pitch: -10.963688850402832, yaw: -72.5560073852539 + 360}
    }, {
      x: 510741.1875, y: 4056768, z: 85.11492919921875,
      rotation: {roll: -0.000013877633136871736, pitch: -10.151579856872559, yaw: -74.29225158691406 + 360}
    }, {
      x: 510767.25, y: 4056783, z: 85.08615112304688,
      rotation: {roll: -0.000003896290309057804, pitch: -9.577516555786133, yaw: -76.02854919433594 + 360}
    }, {
      x: 510792.96875, y: 4056798.75, z: 85.0497817993164,
      rotation: {roll: -0.00001511931714048842, pitch: -8.807433128356934, yaw: -79.12226867675781 + 360}
    }, {
      x: 510817.53125, y: 4056816.25, z: 84.99652099609375,
      rotation: {roll: 0.00001163512388302479, pitch: -7.855345726013184, yaw: -83.13787078857422 + 360}
    }, {
      x: 510841, y: 4056835.25, z: 84.96713256835938,
      rotation: {roll: -0.000004303572950448142, pitch: -7.281370639801025, yaw: -87.27847290039062 + 360}
    }, {
      x: 510863.21875, y: 4056855.25, z: 84.96037292480469,
      rotation: {roll: 0.00001376717773382552, pitch: -7.141351699829102, yaw: -88.13185119628906 + 360}
    }, {
      x: 510876.0625, y: 4056878.75, z: 84.9253921508789,
      rotation: {roll: 0.000012459746358217672, pitch: -6.497401714324951, yaw: -95.60377502441406 + 360}
    }, {
      x: 510875.96875, y: 4056882.5, z: 84.9253921508789,
      rotation: {roll: 0.000012459746358217672, pitch: -6.497401714324951, yaw: -95.60377502441406 + 360}
    }
    ]

    let option = {
      speed: 25,
      unit: 'm/s',
      loop: false,
      isGraphic: false
    }

    let res = await camera.playRoute(route, option)
    printLog(res)
  }

  async function stop() {
    let res = await camera.stopRoute()
    printLog(res)
  }
</script>
</body>
</html>
